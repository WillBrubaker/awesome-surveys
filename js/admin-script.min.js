function getPreview(e){e("#current-element :input").validate(),e("#current-element :input").valid()&&e.post(ajaxurl,e("#awesome-survey :input").serializeArray(),function(t){e("#form-preview").empty().append(t.data[0]),e("#content").val(t.data[1]),e("#existing_elements").val(t.data[2]).trigger("change"),previewReady(e)})}function renumberButtons(e){var t=e(".survey-preview form");e(".single-element-edit",t).each(function(){e(".button-holder button[data-index]",e(this)).attr("data-index",e(this).index())}),e("#existing_elements").trigger("change"),e("#awesome-survey .overlay").hide()}function previewReady(e){e("#form-preview button").button(),e("#current-element").empty(),e("#current-element-wrapper").hide();var t=e("#form-preview fieldset");t.sortable({start:function(t,n){surveyElements=e.parseJSON(e("#existing_elements").val()),startingIndex=n.item.index()},stop:function(t,n){e("#awesome-survey .overlay").show(),endingIndex=n.item.index(),startingIndex!=endingIndex&&(activeElement=surveyElements[startingIndex],surveyElements.splice(startingIndex,1),surveyElements.splice(endingIndex,0,activeElement),e("#existing_elements").val(JSON.stringify(surveyElements)),renumberButtons(e))}}),e("textarea, input","#form-preview-wrapper").each(function(){e(this).prop("required",!1),e(this).removeClass("required")}),e("#form-preview-wrapper").show(),e("#awesome-survey .overlay").hide()}function generateDynamicDialog(e){if(html='<div class="dyn-diag"><form class="pure-form pure-form-stacked form-horizontal" method="post" action=""><input type="text" name="options[name]" value="',html+='" required="required"><label for="required-checkbox">Required? </label><input id="required-checkbox" type="checkbox" name="options[validation][required]" value="1"',"undefined"!=typeof e.validation&&"undefined"!=typeof e.validation.required&&1==e.validation.required&&(html+=' checked="checked"'),html+=">","undefined"!=typeof e.label){display="undefined"!=typeof e.atts&&"undefined"!=typeof e.atts.can_add_options&&"yes"==e.atts.can_add_options?"block":"none",html+='<div class="slider-wrapper" style="display:'+display+';"><div id="edit-slider"></div><div class="slider-legend"></div></div>',html+='<p style="display:'+display+';">answers:</p>',html+='<div id="edit-answers-holder" style="display:'+display+';">';for(key in e.label)count=Number(key)+1,html+='<label for="options-answer-'+key+'">Answer '+(Number(key)+1)+'</label><input id="options-answer-'+key+'" type="text" name="options[label]['+key+']" value="" required="required">',html+='<label for="options-default-'+key+'">default?<br></label><input id="options-default-'+key+'" type="radio" name="options[default]" value="'+key+'"',key==e["default"]&&(html+=' checked="checked"'),html+=">";html+='<p><input type="button" name="options-default-none" value="'+wwm_as_admin_script.clear_default+'" /></p>',html+="</div>"}if("undefined"!=typeof e.validation&&"undefined"!=typeof e.validation.rules)for(index in e.validation.rules)html+='<input type="hidden" name="options[validation][rules]['+index+']" value="'+e.validation.rules[index]+'">';return html+='<input type="hidden" name="options[atts][can_add_options]" value="yes">',html+='<input type="hidden" name="action" value="wwm-as-get-json">',html+="</form></div>",jQuery(html)}function attachDialog(e){e("#surveys #edit-question, #surveys #edit-answer, #surveys #edit-survey-name, #surveys #edit-survey-thanks").dialog({autoOpen:!1,title:"Edit Survey",height:"auto",width:500,modal:!0,buttons:[{text:"Submit",id:"button-ok",click:function(){e("div.wrap").css("cursor","progress"),e("#button-ok").button("disable"),e("#button-cancel").button("disable"),submitVals=e(e(this)).serializeArray(),activeDialog=e(this),e.post(ajaxurl,submitVals,function(t){t.success?e.post(ajaxurl,{action:"get_survey_results"},function(t){e("#existing-surveys").empty().append(t),e("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:!0,active:!1}),e(".answer-accordion").accordion({header:"h4.answers",collapsible:!0,active:!1,heightStyle:"content"}),attachDialog(e)},"html"):0==t.success&&alert(t.data.message)},"json").fail(function(e){alert("error code: "+e.status+" error message "+e.statusText)}).always(function(){activeDialog.dialog("close"),e("div.wrap").css("cursor","default"),e("#button-ok").button("enable"),e("#button-cancel").button("enable")})}},{text:"Cancel",id:"button-cancel",click:function(){e(this).dialog("close"),e("div.wrap").css("cursor","default")}}],open:function(){e(this).keypress(function(t){13==t.keyCode&&(t.preventDefault(),e("#button-ok",e(this).parent()).trigger("click"))})}})}function removeNulls(e){var t=[];for(i=0;i<e.length;i++)null!=e[i]&&"undefined"!=typeof e[i]&&"null"!=typeof e[i]&&t.push(e[i]);return t.length>0?t:null}jQuery("document").ready(function(e){e("#awesome-survey .overlay").hide(),"undefined"!=typeof e("#form-preview").html()&&e("#form-preview").html().length>0&&previewReady(e),e("#survey-elements-buttons button").button().click(function(t){t.preventDefault(),e.post(ajaxurl,{action:"add-form-element",element:e(this).attr("name"),_as_nonce:e(this).data("nonce")},function(t){e("#current-element").empty().append(t),existingElements=e("#existing_elements"),"undefined"!=typeof existingElements&&"undefined"!=typeof existingElements.val()&&e("#existing_elements").val(existingElements.val()),e("#current-element-wrapper").show(),e("#slider").slider({range:!1,max:wwm_as_admin_script.num_answers?wwm_as_admin_script.num_answers:10,min:1,step:1,change:function(t,n){var i=n.value,a=e('[type="radio"]',e("#options-holder")),l=a.index(e('[type="radio"]:checked',e("#options-holder"))),o=[];e('[name^="options[label]["]',e("#options-holder")).each(function(){o.push(e(this).val())}),e.post(ajaxurl,{action:"options-fields",num_options:i},function(t){e("#current-element #options-holder").empty().append(t.data),e('[name^="options[label]["]',e("#options-holder")).each(function(t){e(this).val(o[t])}),l>-1&&e('[type="radio"]:eq('+l+")",e("#options-holder")).prop("checked",!0)})}}).each(function(){for(var t=e(this).data().uiSlider.options,n=t.max-t.min,i=0;n>=i;i++){var a=e("<label>"+(i+t.min)+"</label>").css("left",i/n*100+"%");e("#slider").append(a)}}),e("#current-element button").button(),e("#current-element").on("click",'button[name="options-default-none"]',function(t){e('input[name="options[default]"]').prop("checked",!1),t.preventDefault(),t.stopImmediatePropagation()}),e("#current-element").on("click","button",function(t){e("#awesome-survey .overlay").show(),t.preventDefault(),getPreview(e)})}).fail(function(e){alert("error status code: "+e.status+" error message: "+e.statusText)})}),e("#form-preview").on("click","button.element-edit",function(t){t.preventDefault(),action=e(this).attr("data-action");var n=e(this).data("index"),i=e(this).closest(".single-element-edit"),a=e.parseJSON(e("#existing_elements").val());if("delete"==action)e("#awesome-survey .overlay").show(),i.remove(),delete a[n],e("#awesome-survey .overlay").hide();else{label=e("label.control-label",e(this).closest(".single-element-edit"));var l=generateDynamicDialog(a[n]);l.dialog({title:"Edit Survey Question",modal:!0,buttons:[{text:"Cancel",click:function(){e(this).dialog("destroy"),e("#edit-slider").slider("destroy")}},{text:"Submit",click:function(t){e("#awesome-survey .overlay").show(),a=e.parseJSON(e("#existing_elements").val()),t.preventDefault();var o=e("form",l),r=e("form",l).serializeArray(),s=o.validate();s.form()&&e.post(ajaxurl,r,function(t){if(r=t.data,r=e.parseJSON(r),elementType=a[n].type,a[n]=r,a[n].type=elementType,label.text(r.name),1==a[n].validation.required&&label.prepend('<span class="required">* </span>'),a=removeNulls(a),"undefined"!=typeof a[n].label){var l;if(newHtml="",type=a[n].type,"dropdown"==type){l=e("select",i);for(key in a[n].value)newHtml+='<option value="'+key+'"',key==a[n]["default"]&&(newHtml+=' selected="selected"'),newHtml+=">"+r.label[key]+"</option>"}else{l=e(".controls",i),setName=e('[type="'+type+'"]:first',l).attr("name");for(key in a[n].value)newHtml+='<label class="'+type+'"><input type="'+type+'" name="'+setName+'" value="'+key+'"',key==a[n]["default"]&&(newHtml+=' checked="checked"'),newHtml+="> "+r.label[key]+"</label>"}l.empty().append(newHtml)}e("#existing_elements").val(JSON.stringify(a)).trigger("change")}).fail(function(e){alert("error status code: "+e.status+" error message: "+e.statusText)}).always(function(){l.dialog("destroy"),e("#edit-slider").slider("destroy"),e("#awesome-survey .overlay").hide()})}}],open:function(){e(this).keypress(function(t){t.keyCode==e.ui.keyCode.ENTER&&(t.preventDefault(),e(this).parent().find("button:eq(2)").trigger("click"))}),e('[name="options[name]"]',l).val(a[n].name.replace(/\\/g,"")),textInputs=e('#edit-answers-holder [type="text"]',l),textInputs.each(function(){currentEl=textInputs.index(e(this)),e(this).val(a[n].label[currentEl].replace(/\\/g,""))}),e("#edit-slider").slider({value:"undefined"!=typeof a[n].label?a[n].label.length:0,range:!1,max:10,min:1,step:1,change:function(t,i){var o=i.value,r=e('[type="radio"]',l),s=r.index(e('[type="radio"]:checked',l));e.post(ajaxurl,{action:"options-fields",num_options:o},function(t){e("#edit-answers-holder").empty().append(t.data);for(key in a[n].label)e('[name="options[label]['+key+']"]').val(a[n].label[key]);s>-1&&e('#edit-answers-holder input[type="radio"]:eq('+s+")").prop("checked",!0)})}}).each(function(){for(var t=e(this).data().uiSlider.options,n=t.max-t.min,i=0;n>=i;i++){var a=e("<label>"+(i+t.min)+"</label>").css("left",i/n*100+"%");e("#edit-slider").append(a)}})}}),e(".dyn-diag").on("click","input[name=options-default-none]",function(){e('input[name="options[default]"]').prop("checked",!1)})}a=removeNulls(a),e("#existing_elements").val(JSON.stringify(a)).trigger("change")}),e("#form-preview").on("click",'input[name="reset"]',function(t){t.preventDefault(),reset=confirm(commonL10n.warnDelete),1==reset&&(e("#existing_elements").val("").trigger("change"),e("#content").val(""),e("#form-preview-wrapper").hide(),e("#form-preview").empty())}),e("#current-element").on("keydown",function(t){13===t.keyCode&&(t.preventDefault(),e(this).trigger("blur"),getPreview(e))}),e("#existing_elements").on("change",function(){e.post(ajaxurl,{survey_id:e("#post_ID").val(),existing_elements:e("#existing_elements").val(),action:"update-post-content"},function(t){t.success?e("#content").val(t.data):alert(t.data)})}),e('textarea, input[type="email"], input[type="number"], input[type="text"] ',"#form-preview-wrapper").on("keyup",function(){e(this).val("")})});