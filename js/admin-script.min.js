jQuery("document").ready(function(a){if(typeof a("#form-preview").html()!="undefined"&&a("#form-preview").html().length>0){previewReady(a)}a("#survey-elements-buttons button").button().click(function(b){b.preventDefault();a.post(ajaxurl,{action:"add-form-element",element:a(this).attr("name"),_as_nonce:a(this).data("nonce")},function(c){a("#current-element").empty().append(c);existingElements=a("#existing_elements");if("undefined"!=typeof existingElements&&"undefined"!=typeof existingElements.val()){a("#existing_elements").val(existingElements.val())}a("#current-element-wrapper").show();a("#slider").slider({range:false,max:(wwm_as_admin_script.num_answers)?wwm_as_admin_script.num_answers:10,min:1,step:1,change:function(g,h){var f=h.value;var j=a('[type="radio"]',a("#options-holder"));var d=j.index(a('[type="radio"]:checked',a("#options-holder")));var e=[];a('[name^="options[label]["]',a("#options-holder")).each(function(){e.push(a(this).val())});a.post(ajaxurl,{action:"options-fields",num_options:f},function(k){a("#current-element #options-holder").empty().append(k.data);a('[name^="options[label]["]',a("#options-holder")).each(function(l){a(this).val(e[l])});if(d>-1){a('[type="radio"]:eq('+d+")",a("#options-holder")).prop("checked",true)}})}}).each(function(){var e=a(this).data().uiSlider.options;var g=e.max-e.min;for(var d=0;d<=g;d++){var f=a("<label>"+(d+e.min)+"</label>").css("left",(d/g*100)+"%");a("#slider").append(f)}});a("#current-element button").button();a("#current-element").on("click","button",function(d){d.preventDefault();getPreview(a)})}).fail(function(c){alert("error status code: "+c.status+" error message: "+c.statusText)})});a("#form-preview").on("click","button.element-edit",function(g){g.preventDefault();action=a(this).attr("data-action");var f=a(this).data("index");var b=a(this).closest(".single-element-edit");var c=a.parseJSON(a("#existing_elements").val());if("delete"==action){b.remove();delete c[f]}else{label=a("label.control-label",a(this).closest(".single-element-edit"));var d=generateDynamicDialog(c[f]);d.dialog({title:"Edit Survey Question",modal:true,buttons:[{text:"Cancel",click:function(){a(this).dialog("destroy");a("#edit-slider").slider("destroy")}},{text:"Submit",click:function(l){c=a.parseJSON(a("#existing_elements").val());l.preventDefault();var j=a("form",d);var k=a("form",d).serializeArray();var h=j.validate();if(h.form()){a.post(ajaxurl,k,function(e){k=e.data;k=a.parseJSON(k);elementType=c[f].type;c[f]=k;c[f].type=elementType;label.text(k.name);if(1==c[f].validation.required){label.prepend('<span class="required">* </span>')}c=removeNulls(c);if("undefined"!=typeof c[f].label){var m;newHtml="";type=c[f].type;if("dropdown"==type){m=a("select",b);for(key in c[f].value){newHtml+='<option value="'+key+'"';if(key==c[f]["default"]){newHtml+=' selected="selected"'}newHtml+=">"+k.label[key]+"</option>"}}else{m=a(".controls",b);setName=a('[type="'+type+'"]:first',m).attr("name");for(key in c[f].value){newHtml+='<label class="'+type+'"><input type="'+type+'" name="'+setName+'" value="'+key+'"';if(key==c[f]["default"]){newHtml+=' checked="checked"'}newHtml+="> "+k.label[key]+"</label>"}}m.empty().append(newHtml)}a("#existing_elements").val(JSON.stringify(c)).trigger("change")}).fail(function(e){alert("error status code: "+e.status+" error message: "+e.statusText)}).always(function(){d.dialog("destroy");a("#edit-slider").slider("destroy")})}}}],open:function(){a(this).keypress(function(h){if(h.keyCode==a.ui.keyCode.ENTER){h.preventDefault();a(this).parent().find("button:eq(2)").trigger("click")}});a('[name="options[name]"]',d).val(c[f].name.replace(/\\/g,""));textInputs=a('#edit-answers-holder [type="text"]',d);textInputs.each(function(){currentEl=textInputs.index(a(this));a(this).val(c[f].label[currentEl].replace(/\\/g,""))});a("#edit-slider").slider({value:("undefined"!=typeof c[f].label)?c[f].label.length:0,range:false,max:10,min:1,step:1,change:function(j,k){var h=k.value;var l=a('[type="radio"]',d);var e=l.index(a('[type="radio"]:checked',d));a.post(ajaxurl,{action:"options-fields",num_options:h},function(m){a("#edit-answers-holder").empty().append(m.data);for(key in c[f].label){a('[name="options[label]['+key+']"]').val(c[f].label[key])}if(e>-1){a('#edit-answers-holder input[type="radio"]:eq('+e+")").prop("checked",true)}})}}).each(function(){var h=a(this).data().uiSlider.options;var k=h.max-h.min;for(var e=0;e<=k;e++){var j=a("<label>"+(e+h.min)+"</label>").css("left",(e/k*100)+"%");a("#edit-slider").append(j)}})}})}c=removeNulls(c);a("#existing_elements").val(JSON.stringify(c)).trigger("change")});a("#form-preview").on("click",'input[name="reset"]',function(b){b.preventDefault();reset=confirm(commonL10n.warnDelete);if(true==reset){a("#existing_elements").val("");a("#content").val("");a("#form-preview-wrapper").hide();a("#form-preview").empty()}});a("#current-element").on("keydown",function(b){if(13===b.keyCode){b.preventDefault();a(this).trigger("blur");getPreview(a)}});a("#existing_elements").on("change",function(){a.post(ajaxurl,{survey_id:a("#post_ID").val(),existing_elements:a("#existing_elements").val(),action:"update-post-content"},function(b){a("#content").val(b.data)})})});function getPreview(a){a("#current-element :input").validate();if(a("#current-element :input").valid()){a.post(ajaxurl,a("#awesome-survey :input").serializeArray(),function(b){a("#form-preview").empty().append(b.data[0]);a("#content").val(b.data[1]);a("#existing_elements").val(b.data[2]);previewReady(a)})}}function renumberButtons(b){var a=b(".survey-preview form");b(".single-element-edit",a).each(function(){b(".button-holder button[data-index]",b(this)).attr("data-index",b(this).index())});b("#existing_elements").trigger("change")}function previewReady(b){b("#form-preview button").button();b("#current-element").empty();b("#current-element-wrapper").hide();var a=b("#form-preview fieldset");a.sortable({start:function(c,d){surveyElements=b.parseJSON(b("#existing_elements").val());startingIndex=d.item.index()},stop:function(c,d){endingIndex=d.item.index();if(startingIndex!=endingIndex){activeElement=surveyElements[startingIndex];surveyElements.splice(startingIndex,1);surveyElements.splice(endingIndex,0,activeElement);b("#existing_elements").val(JSON.stringify(surveyElements));renumberButtons(b)}}});b("#form-preview input").each(function(){if("button"!=b(this).attr("type")){b(this).prop("disabled",true)}});b("#form-preview-wrapper").show()}function generateDynamicDialog(a){html='<div class="dyn-diag"><form class="pure-form pure-form-stacked form-horizontal" method="post" action=""><input type="text" name="options[name]" value="';html+='" required="required"><label for="required-checkbox">Required? </label><input id="required-checkbox" type="checkbox" name="options[validation][required]" value="1"';if(typeof a.validation!="undefined"&&typeof a.validation.required!="undefined"&&1==a.validation.required){html+=' checked="checked"'}html+=">";if("undefined"!=typeof a.label){display=("undefined"!=typeof a.atts&&"undefined"!=typeof a.atts.can_add_options&&"yes"==a.atts.can_add_options)?"block":"none";html+='<div class="slider-wrapper" style="display:'+display+';"><div id="edit-slider"></div><div class="slider-legend"></div></div>';html+='<p style="display:'+display+';">answers:</p>';html+='<div id="edit-answers-holder" style="display:'+display+';">';for(key in a.label){count=Number(key)+1;html+='<label for="options-answer-'+key+'">Answer '+(Number(key)+1)+'</label><input id="options-answer-'+key+'" type="text" name="options[label]['+key+']" value="" required="required">';html+='<label for="options-default-'+key+'">default?<br></label><input id="options-default-'+key+'" type="radio" name="options[default]" value="'+key+'"';if(key==a["default"]){html+=' checked="checked"'}html+=">"}html+="</div>"}if("undefined"!=typeof a.validation&&"undefined"!=typeof a.validation.rules){for(index in a.validation.rules){html+='<input type="hidden" name="options[validation][rules]['+index+']" value="'+a.validation.rules[index]+'">'}}html+='<input type="hidden" name="action" value="wwm-as-get-json">';html+="</form></div>";return jQuery(html)}function attachDialog(a){a("#surveys #edit-question, #surveys #edit-answer, #surveys #edit-survey-name, #surveys #edit-survey-thanks").dialog({autoOpen:false,title:"Edit Survey",height:"auto",width:500,modal:true,buttons:[{text:"Submit",id:"button-ok",click:function(){a("div.wrap").css("cursor","progress");a("#button-ok").button("disable");a("#button-cancel").button("disable");submitVals=a(a(this)).serializeArray();activeDialog=a(this);a.post(ajaxurl,submitVals,function(b){if(b.success){a.post(ajaxurl,{action:"get_survey_results"},function(c){a("#existing-surveys").empty().append(c);a("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:true,active:false});a(".answer-accordion").accordion({header:"h4.answers",collapsible:true,active:false,heightStyle:"content"});attachDialog(a)},"html")}else{if(false==b.success){alert(b.data.message)}}},"json").fail(function(b){alert("error code: "+b.status+" error message "+b.statusText)}).always(function(){activeDialog.dialog("close");a("div.wrap").css("cursor","default");a("#button-ok").button("enable");a("#button-cancel").button("enable")})}},{text:"Cancel",id:"button-cancel",click:function(){a(this).dialog("close");a("div.wrap").css("cursor","default")}}],open:function(){a(this).keypress(function(b){if(13==b.keyCode){b.preventDefault();a("#button-ok",a(this).parent()).trigger("click")}})}})}function removeNulls(b){var a=[];for(i=0;i<b.length;i++){if(b[i]!=null&&"undefined"!=typeof b[i]&&"null"!=typeof b[i]){a.push(b[i])}}return(a.length>0)?a:null};