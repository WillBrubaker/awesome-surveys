jQuery(document).ready(function(b){var a=b("#new-elements").html();b("#tabs").tabs();b("#tabs #create #survey-manager").validate({submitHandler:function(c){overlay=b(".overlay",b(c));overlay.show();b.post(ajaxurl,b(c).serializeArray(),function(g){if(false==g.success){alert(g.data)}else{var e=b(".create_holder").html();b("#survey-manager").hide();var d=g.form;b(g.form).insertBefore("#add-element");b('#new-elements input[type="submit"]').prop("disabled",true);b("#new-elements").show();var f=b('input[type="hidden"][name="survey_name"]').val();b("#preview h4.survey-name").text("Preview of Survey: "+f)}b(".accordion").accordion({collapsible:true,active:0,header:"h5",heightStyle:"content"});overlay.hide()},"json")}});b("#new-elements").on("change",".type-selector",function(){var c=b("#create > .overlay");var d=b(":selected",this).val();b('#new-elements input[type="submit"]').prop("disabled",true);c.show();if(d!=""){b.post(ajaxurl,{action:"get_element_form",type:b(":selected",this).val(),text:b(":selected",this).text()},function(e){b("#add-element").empty().append(e.form);b("#slider").slider({range:false,max:10,min:1,step:1,change:function(g,h){var f=h.value;b.post(ajaxurl,{action:"options_fields",num_options:f},function(i){b("#new-elements #options-holder").empty().append(i)})}}).each(function(){var g=b(this).data().uiSlider.options;var j=g.max-g.min;for(var f=0;f<=j;f++){var h=b("<label>"+(f+g.min)+"</label>").css("left",(f/j*100)+"%");b("#slider").append(h)}});b("#new-elements").tooltip({position:{my:"left+15 center",at:"right top"},show:{effect:"blind",duration:800}});b("#tabs #new-elements").validate({submitHandler:function(i){var g=b("#create > .overlay");g.show();var h=b('#save-survey input[type="hidden"][name="existing_elements"]').val();var f;if(typeof h!="undefined"){f=b("<input>",{type:"hidden",name:"existing_elements",value:h});b("#new-elements").append(b(f))}b.post(ajaxurl,b(i).serializeArray(),function(j){b("#preview .survey-preview").empty().append(j)});b("#add-element").empty();b('#new-elements input[type="submit"]').prop("disabled",true);b(".accordion").accordion("option","active",false);b('#new-element-selector .type-selector option[value=""]').prop("selected",true);g.hide()}});b('#new-elements input[type="submit"]').prop("disabled",false)},"json")}else{b("#add-element").empty()}c.hide()});b("#preview").on("click",'.survey-preview form input[type="submit"]',function(){b('input[type="submit"]',b(this).parents("form")).removeAttr("clicked");b(this).attr("clicked","true")});b("#preview .survey-preview").on("submit","form#save-survey",function(g){g.preventDefault();var d=b("#create > .overlay");d.show();var f=b(this);var c=b('input[type="submit"][clicked="true"]').attr("name");if("save"==c){b.post(ajaxurl,b(this).serializeArray(),function(e){if(e.success){b.post(ajaxurl,{action:"get_survey_results"},function(h){b("#existing-surveys").empty().append(h);b("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:true,active:false});b(".answer-accordion").accordion({header:"h4.answers",collapsible:true,active:false,heightStyle:"content"});attachDialog(b)},"html")}else{alert(e.data)}}).fail(function(e){alert("error code: "+e.status+" error message "+e.statusText)}).always(function(){b("#preview h4.survey-name").empty();b(".survey-preview").empty();b("#add-element").empty();b('#new-element-selector .type-selector option[value=""]').prop("selected",true);b("#new-elements").empty().append(a).hide();b("#survey-manager").show();d.hide()})}});b("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:true,active:false});b(".answer-accordion").accordion({header:"h4.answers",collapsible:true,active:false,heightStyle:"content"});b("#surveys").on("click","a.edit-question",function(c){c.preventDefault();b('#edit-question input[name="survey_id"]').val(b(this).attr("data-survey_id"));b('#edit-question input[name="question_id"]').val(b(this).attr("data-question_id"));b('#edit-question input[name="_nonce"]').val(b(this).attr("data-nonce"));b('#edit-question input[name="question"]').val(b(this).text());b("#edit-question").dialog("open")});b("#surveys").on("click","a.edit-answer-option",function(c){c.preventDefault();b('#edit-answer input[name="survey_id"]').val(b(this).attr("data-survey_id"));b('#edit-answer input[name="question_id"]').val(b(this).attr("data-question_id"));b('#edit-answer input[name="answer_id"]').val(b(this).attr("data-answer_id"));b('#edit-answer input[name="_nonce"]').val(b(this).attr("data-nonce"));b('#edit-answer input[name="answer"]').val(b(this).text());b("#edit-answer").dialog("open")});b("#surveys").on("click","a.edit-survey-name",function(c){c.preventDefault();b('#edit-survey-name input[name="survey_id"]').val(b(this).attr("data-survey_id"));b('#edit-survey-name input[name="_nonce"]').val(b(this).attr("data-nonce"));b('#edit-survey-name input[name="name"]').val(b(this).text());b("#edit-survey-name").dialog("open")});b("#surveys").on("click","a.edit-thanks",function(c){c.preventDefault();b('#edit-survey-thanks input[name="survey_id"]').val(b(this).attr("data-survey_id"));b('#edit-survey-thanks input[name="_nonce"]').val(b(this).attr("data-nonce"));b('#edit-survey-thanks textarea[name="thank_you"]').val(b(this).text());b("#edit-survey-thanks").dialog("open")});b("#surveys").on("click","a.edit-auth-method",function(c){c.preventDefault();b.post(ajaxurl,{action:"wwm_get_auth_method_edit_form",survey_id:b(this).attr("data-survey_id"),_nonce:b(this).attr("data-nonce")},function(d){b(d.data).dialog({modal:true,title:"Edit Survey Auth Method",width:500,buttons:[{text:"Submit",id:"button-ok",click:function(){b("div.wrap").css("cursor","progress");submitVals=b(b(this)).serializeArray();activeDialog=b(this);b.post(ajaxurl,submitVals,function(e){if(e.success){b.post(ajaxurl,{action:"get_survey_results"},function(f){b("#existing-surveys").empty().append(f);b("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:true,active:false});b(".answer-accordion").accordion({header:"h4.answers",collapsible:true,active:false,heightStyle:"content"});attachDialog(b)},"html")}else{if(false==e.success){alert(e.data.message)}}},"json").fail(function(e){alert("error code: "+e.status+" error message "+e.statusText)}).always(function(){activeDialog.dialog("destroy");b("div.wrap").css("cursor","default")})}},{text:"Cancel",id:"button-cancel",click:function(){b(this).dialog("destroy");b("div.wrap").css("cursor","default")}}],open:function(){b(this).keypress(function(f){if(13==f.keyCode){f.preventDefault();b("#button-ok",b(this).parent()).trigger("click")}})}})})});b("#surveys").on("submit","form.delete-survey",function(c){c.preventDefault();result=confirm("Really delete this survey? This action is permanent and not reversible!");if(true==result){b.post(ajaxurl,b(this).serializeArray(),function(d){if(d.success){b.post(ajaxurl,{action:"get_survey_results"},function(e){b("#existing-surveys").empty().append(e);b("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:true,active:false});b(".answer-accordion").accordion({header:"h4.answers",collapsible:true,active:false,heightStyle:"content"});attachDialog(b)},"html")}}).fail(function(d){alert("error code: "+d.status+" message: "+d.statusText)}).always(function(){})}});b("#styling-options").on("submit",function(c){c.preventDefault();overlay=b(".overlay",b(this));overlay.show();b.post(ajaxurl,b(this).serializeArray(),function(d){}).fail(function(d){alert("error code: "+d.status+" error message "+d.statusText)}).always(function(){overlay.hide()})});attachDialog(b)});var activeDialog;function attachDialog(a){a("#surveys #edit-question, #surveys #edit-answer, #surveys #edit-survey-name, #surveys #edit-survey-thanks").dialog({autoOpen:false,title:"Edit Survey",height:"auto",width:500,modal:true,buttons:[{text:"Submit",id:"button-ok",click:function(){a("div.wrap").css("cursor","progress");a("#button-ok").button("disable");a("#button-cancel").button("disable");submitVals=a(a(this)).serializeArray();activeDialog=a(this);a.post(ajaxurl,submitVals,function(b){if(b.success){a.post(ajaxurl,{action:"get_survey_results"},function(c){a("#existing-surveys").empty().append(c);a("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:true,active:false});a(".answer-accordion").accordion({header:"h4.answers",collapsible:true,active:false,heightStyle:"content"});attachDialog(a)},"html")}else{if(false==b.success){alert(b.data.message)}}},"json").fail(function(b){alert("error code: "+b.status+" error message "+b.statusText)}).always(function(){activeDialog.dialog("close");a("div.wrap").css("cursor","default");a("#button-ok").button("enable");a("#button-cancel").button("enable")})}},{text:"Cancel",id:"button-cancel",click:function(){a(this).dialog("close");a("div.wrap").css("cursor","default")}}],open:function(){a(this).keypress(function(b){if(13==b.keyCode){b.preventDefault();a("#button-ok",a(this).parent()).trigger("click")}})}})};