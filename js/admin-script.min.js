jQuery(document).ready(function(b){var a=b("#new-elements").html();b("#tabs").tabs();b("#tabs #create #survey-manager").validate({submitHandler:function(c){overlay=b(".overlay",b(c));overlay.show();b.post(ajaxurl,b(c).serializeArray(),function(g){if(false==g.success){alert(g.data)}else{var e=b(".create_holder").html();b("#survey-manager").hide();var d=g.form;b(g.form).insertBefore("#add-element");b('#new-elements input[type="submit"]').prop("disabled",true);b("#new-elements").show();var f=b('input[type="hidden"][name="survey_name"]').val();b("#preview h4.survey-name").text("Preview of Survey: "+f)}b(".accordion").accordion({collapsible:true,active:0,header:"h5",heightStyle:"content"});overlay.hide()},"json")}});b("#new-elements").on("change",".type-selector",function(){var c=b("#create > .overlay");var d=b(":selected",this).val();b('#new-elements input[type="submit"]').prop("disabled",true);c.show();if(d!=""){b.post(ajaxurl,{action:"get_element_form",type:b(":selected",this).val(),text:b(":selected",this).text()},function(e){b("#add-element").empty().append(e.form);b("#slider").slider({range:false,max:10,min:1,step:1,change:function(g,h){var f=h.value;b.post(ajaxurl,{action:"options_fields",num_options:f},function(j){b("#new-elements #options-holder").empty().append(j)})}}).each(function(){var g=b(this).data().uiSlider.options;var j=g.max-g.min;for(var f=0;f<=j;f++){var h=b("<label>"+(f+g.min)+"</label>").css("left",(f/j*100)+"%");b("#slider").append(h)}});b("#new-elements").tooltip({position:{my:"left+15 center",at:"right top"},show:{effect:"blind",duration:800}});b("#tabs #new-elements").validate({submitHandler:function(j){var g=b("#create > .overlay");g.show();var h=b('#save-survey input[type="hidden"][name="existing_elements"]').val();var f;if(typeof h!="undefined"){f=b("<input>",{type:"hidden",name:"existing_elements",value:h});b("#new-elements").remove('[name="existing_elements"]').append(b(f))}b.post(ajaxurl,b(j).serializeArray(),function(k){b("#preview .survey-preview").empty().append(k);b("#add-element").empty();b('#new-elements input[type="submit"]').prop("disabled",true);b(".accordion").accordion("option","active",false);b('#new-element-selector .type-selector option[value=""]').prop("selected",true);b("button").button();elementsJSON=b.parseJSON(b('form#save-survey [name="existing_elements"]').val());b(elementsJSON).each(function(l,m){})}).fail(function(k){alert("error status code: "+k.status+" error message: "+k.statusText)}).always(function(){g.hide()})}});b('#new-elements input[type="submit"]').prop("disabled",false)},"json")}else{b("#add-element").empty()}c.hide()});b("#preview").on("click",'.survey-preview form input[type="submit"]',function(){b('input[type="submit"]',b(this).parents("form")).removeAttr("clicked");b(this).attr("clicked","true")});b("#preview .survey-preview").on("submit","form#save-survey",function(g){g.preventDefault();var d=b("#create > .overlay");var f=b(this);var c=b('input[type="submit"][clicked="true"]').attr("name");d.show();if("save"==c){b.post(ajaxurl,b(this).serializeArray(),function(e){if(e.success){b.post(ajaxurl,{action:"get_survey_results"},function(h){b("#existing-surveys").empty().append(h);b("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:true,active:false});b(".answer-accordion").accordion({header:"h4.answers",collapsible:true,active:false,heightStyle:"content"});b('#survey-manager [name="survey_name"]').val("");attachDialog(b)},"html")}else{alert(e.data)}}).fail(function(e){alert("error code: "+e.status+" error message "+e.statusText)}).always(function(){b("#preview h4.survey-name").empty();b(".survey-preview").empty();b("#add-element").empty();b('#new-element-selector .type-selector option[value=""]').prop("selected",true);b("#new-elements").empty().append(a).hide();b("#survey-manager").show();d.hide()})}else{b("#survey-manager").trigger("reset");location.reload()}});b("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:true,active:false});b(".answer-accordion").accordion({header:"h4.answers",collapsible:true,active:false,heightStyle:"content"});b("#surveys").on("click","a.edit-question",function(c){c.preventDefault();b('#edit-question input[name="survey_id"]').val(b(this).attr("data-survey_id"));b('#edit-question input[name="question_id"]').val(b(this).attr("data-question_id"));b('#edit-question input[name="_nonce"]').val(b(this).attr("data-nonce"));b('#edit-question input[name="question"]').val(b(this).text());b("#edit-question").dialog("open")});b("#surveys").on("click","a.edit-answer-option",function(c){c.preventDefault();b('#edit-answer input[name="survey_id"]').val(b(this).attr("data-survey_id"));b('#edit-answer input[name="question_id"]').val(b(this).attr("data-question_id"));b('#edit-answer input[name="answer_id"]').val(b(this).attr("data-answer_id"));b('#edit-answer input[name="_nonce"]').val(b(this).attr("data-nonce"));b('#edit-answer input[name="answer"]').val(b(this).text());b("#edit-answer").dialog("open")});b("#surveys").on("click","a.edit-survey-name",function(c){c.preventDefault();b('#edit-survey-name input[name="survey_id"]').val(b(this).attr("data-survey_id"));b('#edit-survey-name input[name="_nonce"]').val(b(this).attr("data-nonce"));b('#edit-survey-name input[name="name"]').val(b(this).text());b("#edit-survey-name").dialog("open")});b("#surveys").on("click","a.edit-thanks",function(c){c.preventDefault();b('#edit-survey-thanks input[name="survey_id"]').val(b(this).attr("data-survey_id"));b('#edit-survey-thanks input[name="_nonce"]').val(b(this).attr("data-nonce"));b('#edit-survey-thanks textarea[name="thank_you"]').val(b(this).text());b("#edit-survey-thanks").dialog("open")});b("#surveys").on("click","a.edit-auth-method",function(c){c.preventDefault();b.post(ajaxurl,{action:"wwm_get_auth_method_edit_form",survey_id:b(this).attr("data-survey_id"),_nonce:b(this).attr("data-nonce")},function(d){b(d.data).dialog({modal:true,title:"Edit Survey Auth Method",width:500,buttons:[{text:"Submit",id:"button-ok",click:function(){b("div.wrap").css("cursor","progress");submitVals=b(b(this)).serializeArray();activeDialog=b(this);b.post(ajaxurl,submitVals,function(e){if(e.success){b.post(ajaxurl,{action:"get_survey_results"},function(f){b("#existing-surveys").empty().append(f);b("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:true,active:false});b(".answer-accordion").accordion({header:"h4.answers",collapsible:true,active:false,heightStyle:"content"});attachDialog(b)},"html")}else{if(false==e.success){alert(e.data.message)}}},"json").fail(function(e){alert("error code: "+e.status+" error message "+e.statusText)}).always(function(){activeDialog.dialog("destroy");b("div.wrap").css("cursor","default")})}},{text:"Cancel",id:"button-cancel",click:function(){b(this).dialog("destroy");b("div.wrap").css("cursor","default")}}],open:function(){b(this).keypress(function(f){if(13==f.keyCode){f.preventDefault();b("#button-ok",b(this).parent()).trigger("click")}})}})})});b("#surveys").on("submit","form.delete-survey",function(c){c.preventDefault();result=confirm("Really delete this survey? This action is permanent and not reversible!");if(true==result){b.post(ajaxurl,b(this).serializeArray(),function(d){if(d.success){b.post(ajaxurl,{action:"get_survey_results"},function(e){b("#existing-surveys").empty().append(e);b("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:true,active:false});b(".answer-accordion").accordion({header:"h4.answers",collapsible:true,active:false,heightStyle:"content"});attachDialog(b)},"html")}}).fail(function(d){alert("error code: "+d.status+" message: "+d.statusText)}).always(function(){})}});b("#styling-options").on("submit",function(c){c.preventDefault();overlay=b(".overlay",b(this));overlay.show();b.post(ajaxurl,b(this).serializeArray(),function(d){}).fail(function(d){alert("error code: "+d.status+" error message "+d.statusText)}).always(function(){overlay.hide()})});b("#tabs").on("change",'form#save-survey [name="existing_elements"]',function(){target=b('#tabs #save-survey input[type="submit"][name="save"]');if("null"==b(this).val()){b(this).val("");target.prop("disabled",true)}else{target.prop("disabled",false)}});b("#tabs").on("click","#preview button.element-edit",function(h){h.preventDefault();action=b(this).attr("data-action");var g=b(this).attr("data-index");var c=b(this).closest(".single-element-edit");var d=b.parseJSON(b('form#save-survey [name="existing_elements"]').val());if("delete"==action){c.remove();delete d[g]}else{label=b("label.control-label",b(this).closest(".single-element-edit"));var f=generateDynamicDialog(d[g]);f.dialog({title:"Edit Survey Question",modal:true,buttons:[{text:"Cancel",click:function(){b(this).dialog("destroy");b("#edit-slider").slider("destroy")}},{text:"Submit",click:function(m){d=b.parseJSON(b('form#save-survey [name="existing_elements"]').val());m.preventDefault();var k=b("form",f);var l=b("form",f).serializeArray();var j=k.validate();if(j.form()){b.post(ajaxurl,l,function(n){l=n.data;l=b.parseJSON(l);elementType=d[g].type;d[g]=l;d[g].type=elementType;label.text(l.name);if(1==d[g].validation.required){label.prepend('<span class="required">* </span>')}d=removeNulls(d);var e={Element_Radio:"radio",Element_Checkbox:"checkbox"};if("undefined"!=typeof d[g].label){var o;newHtml="";type=(d[g].type in e)?e[d[g].type]:"option";if("option"==type){o=b("select",c);for(key in d[g].value){newHtml+='<option value="'+key+'"';if(key=d[g]["default"]){newHtml+=' selected="selected"'}newHtml+=">"+d[g].label[key]+"</option>"}}else{o=b(".controls",c);setName=b('[type="'+type+'"]:first',o).attr("name");for(key in d[g].value){newHtml+='<label class="'+type+'"><input type="'+type+'" name="'+setName+'" value="'+key+'"';if(key==d[g]["default"]){newHtml+=' checked="checked"'}newHtml+="> "+l.label[key]+"</label>"}}o.empty().append(newHtml)}b('form#save-survey [name="existing_elements"]').val(JSON.stringify(d)).trigger("change");f.dialog("destroy");b("#edit-slider").slider("destroy")})}}}],open:function(){b(this).keypress(function(j){if(j.keyCode==b.ui.keyCode.ENTER){j.preventDefault();b(this).parent().find("button:eq(2)").trigger("click")}});b('[name="options[name]"]',f).val(d[g].name.replace(/\\/g,""));textInputs=b('#edit-answers-holder [type="text"]',f);textInputs.each(function(){currentEl=textInputs.index(b(this));b(this).val(d[g].label[currentEl].replace(/\\/g,""))});b("#edit-slider").slider({value:("undefined"!=typeof d[g].label)?d[g].label.length:0,range:false,max:10,min:1,step:1,change:function(k,l){var j=l.value;var m=b('[type="radio"]',f);var e=m.index(b('[type="radio"]:checked',f));b.post(ajaxurl,{action:"options_fields",num_options:j},function(n){b("#edit-answers-holder").empty().append(n);for(key in d[g].label){b('[name="options[label]['+key+']"]').val(d[g].label[key])}if(e>-1){b('#edit-answers-holder input[type="radio"]:eq('+e+")").prop("checked",true)}})}}).each(function(){var j=b(this).data().uiSlider.options;var l=j.max-j.min;for(var e=0;e<=l;e++){var k=b("<label>"+(e+j.min)+"</label>").css("left",(e/l*100)+"%");b("#edit-slider").append(k)}})}})}d=removeNulls(d);b('form#save-survey [name="existing_elements"]').val(JSON.stringify(d)).trigger("change")});attachDialog(b)});var activeDialog;function generateDynamicDialog(a){html='<div class="dyn-diag"><form class="pure-form pure-form-stacked form-horizontal" method="post" action=""><input type="text" name="options[name]" value="';html+='" required="required"><label for="required-checkbox">Required? </label><input id="required-checkbox" type="checkbox" name="options[validation][required]" value="1"';if(typeof a.validation!="undefined"&&typeof a.validation.required!="undefined"&&1==a.validation.required){html+=' checked="checked"'}html+=">";if("undefined"!=typeof a.label){html+='<div class="slider-wrapper"><div id="edit-slider"></div><div class="slider-legend"></div></div>';html+="<p>answers:</p>";html+='<div id="edit-answers-holder">';for(key in a.label){count=Number(key)+1;html+='<label for="options-answer-'+key+'">Answer '+(Number(key)+1)+'</label><input id="options-answer-'+key+'" type="text" name="options[label]['+key+']" value="" required="required">';html+='<label for="options-default-'+key+'">default?<br></label><input id="options-default-'+key+'" type="radio" name="options[default]" value="'+key+'"';if(key==a["default"]){html+=' checked="checked"'}html+=">"}html+="</div>"}if("undefined"!=typeof a.validation.rules){for(index in a.validation.rules){html+='<input type="hidden" name="options[validation][rules]['+index+']" value="'+a.validation.rules[index]+'">'}}html+='<input type="hidden" name="action" value="wwm_as_get_json">';html+="</form></div>";return jQuery(html)}function attachDialog(a){a("#surveys #edit-question, #surveys #edit-answer, #surveys #edit-survey-name, #surveys #edit-survey-thanks").dialog({autoOpen:false,title:"Edit Survey",height:"auto",width:500,modal:true,buttons:[{text:"Submit",id:"button-ok",click:function(){a("div.wrap").css("cursor","progress");a("#button-ok").button("disable");a("#button-cancel").button("disable");submitVals=a(a(this)).serializeArray();activeDialog=a(this);a.post(ajaxurl,submitVals,function(b){if(b.success){a.post(ajaxurl,{action:"get_survey_results"},function(c){a("#existing-surveys").empty().append(c);a("#survey-responses").accordion({header:"h5",heightStyle:"content",collapsible:true,active:false});a(".answer-accordion").accordion({header:"h4.answers",collapsible:true,active:false,heightStyle:"content"});attachDialog(a)},"html")}else{if(false==b.success){alert(b.data.message)}}},"json").fail(function(b){alert("error code: "+b.status+" error message "+b.statusText)}).always(function(){activeDialog.dialog("close");a("div.wrap").css("cursor","default");a("#button-ok").button("enable");a("#button-cancel").button("enable")})}},{text:"Cancel",id:"button-cancel",click:function(){a(this).dialog("close");a("div.wrap").css("cursor","default")}}],open:function(){a(this).keypress(function(b){if(13==b.keyCode){b.preventDefault();a("#button-ok",a(this).parent()).trigger("click")}})}})}function removeNulls(b){var a=[];for(i=0;i<b.length;i++){if(b[i]!=null&&"undefined"!=typeof b[i]&&"null"!=typeof b[i]){a.push(b[i])}}return(a.length>0)?a:null};